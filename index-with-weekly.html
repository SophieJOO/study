<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í„°ë”” ì¶œì„í‘œ (ì£¼ê°„ ì§‘ê³„ í¬í•¨)</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        .last-update {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }
        .rules-box {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 30px;
        }
        .rules-box h3 {
            margin-top: 0;
            color: #856404;
        }
        .rules-box ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .rules-box li {
            margin: 5px 0;
        }

        /* ì£¼ê°„ í†µê³„ ìŠ¤íƒ€ì¼ */
        #weeklySummary {
            margin-top: 50px;
        }
        #weeklySummary table {
            font-size: 14px;
            width: 100%;
            border-collapse: collapse;
        }
        #weeklySummary th,
        #weeklySummary td {
            border: 1px solid #ddd;
            padding: 10px 8px;
            text-align: center;
        }
        #weeklySummary th {
            font-weight: 600;
        }
        #weeklySummary .info-box {
            background-color: #e3f2fd;
            border: 2px solid #2196F3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        #weeklySummary .legend {
            margin-top: 20px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        #weeklySummary .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        #weeklySummary .legend-box {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 1px solid #ddd;
            vertical-align: middle;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }
        .error {
            text-align: center;
            padding: 50px;
            color: #d32f2f;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            #weeklySummary table {
                font-size: 12px;
            }
            #weeklySummary th,
            #weeklySummary td {
                padding: 6px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“š ìŠ¤í„°ë”” ì¶œì„í‘œ</h1>
        <div class="last-update" id="lastUpdate">ë¡œë”© ì¤‘...</div>

        <div class="rules-box">
            <h3>ğŸ“Œ ì¶œì„ ê·œì¹™</h3>
            <ul>
                <li>ë§¤ì¼ ìƒˆë²½ 3ì‹œê¹Œì§€ ê³µë¶€ ì¸ì¦ í•„ìˆ˜</li>
                <li>ì¥ê¸°ì˜¤í”„ëŠ” êµ¬ê¸€ í¼ìœ¼ë¡œ ì‚¬ì „ ì‹ ì²­</li>
                <li>ê²°ì„ 4íšŒ ì´ìƒ ì‹œ ë²Œì¹™</li>
            </ul>

            <h3>ğŸ“… ì£¼ê°„ ì§‘ê³„ ê¸°ì¤€</h3>
            <ul>
                <li><strong>ì£¼ ë‹¨ìœ„:</strong> ì›”ìš”ì¼ ~ ì¼ìš”ì¼ (7ì¼)</li>
                <li><strong>ì›” ì†Œì†:</strong> ì›”ìš”ì¼ì´ ì†í•œ ë‹¬ì˜ ì£¼ë¡œ ê³„ì‚°</li>
                <li><strong>ì˜ˆì‹œ:</strong> 11ì›” 25ì¼(ì›”) ~ 12ì›” 1ì¼(ì¼) â†’ <strong>11ì›” 4ì£¼ì°¨</strong></li>
                <li><strong>í•„ìš” ì¸ì¦:</strong> ì£¼ 4íšŒ (ì¥ê¸°ì˜¤í”„ ì¼ìˆ˜ë§Œí¼ ì°¨ê°)</li>
                <li><strong>ì§„í–‰ì¤‘ì¸ ì£¼:</strong> ì¼ìš”ì¼ì´ ì§€ë‚˜ì§€ ì•Šì€ ì£¼ëŠ” ê²°ì„ ê³„ì‚° ì•ˆí•¨</li>
            </ul>
        </div>

        <div id="loading" class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
        <div id="error" class="error" style="display: none;"></div>

        <div id="attendanceContent" style="display: none;">
            <!-- ì¶œì„í‘œëŠ” ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>
    </div>

    <script>
        // âš ï¸ ì—¬ê¸°ì— ì‹¤ì œ ê°’ì„ ì…ë ¥í•˜ì„¸ìš”!
        const JSON_FILE_IDS = {
            attendance: 'YOUR_ATTENDANCE_JSON_FILE_ID',  // attendance_summary_{ë…„ì›”}.json íŒŒì¼ ID
            weekly: 'YOUR_WEEKLY_JSON_FILE_ID'           // weekly_summary_{ë…„ì›”}.json íŒŒì¼ ID
        };

        // í˜„ì¬ ë‚ ì§œ ì •ë³´
        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth();
        const currentDay = now.getDate();

        /**
         * HTML ì´ìŠ¤ì¼€ì´í”„
         */
        function escapeHtml(text) {
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return String(text).replace(/[&<>"']/g, m => map[m]);
        }

        /**
         * ì£¼ê°„ í†µê³„ ë Œë”ë§
         */
        function renderWeeklySummary(weeklyData) {
            let weeklyContainer = document.getElementById('weeklySummary');

            if (!weeklyContainer) {
                const container = document.querySelector('.container');
                weeklyContainer = document.createElement('div');
                weeklyContainer.id = 'weeklySummary';
                container.appendChild(weeklyContainer);
            }

            let html = `
                <h2 style="text-align: center; color: #333; margin-bottom: 20px;">
                    ğŸ“Š ì£¼ê°„ ì¶œì„ ì§‘ê³„ (${weeklyData.ë…„ì›”})
                </h2>

                <div class="info-box">
                    <h4 style="margin-top: 0; color: #1976D2;">â„¹ï¸ ${weeklyData.ì•ˆë‚´.ì„¤ëª…}</h4>
                    <p style="margin: 5px 0;"><strong>ì˜ˆì‹œ:</strong> ${weeklyData.ì•ˆë‚´.ì˜ˆì‹œ}</p>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th rowspan="2" style="background-color: #2196F3; color: white;">ì¡°ì›</th>
            `;

            // ì£¼ì°¨ í—¤ë” ìƒì„±
            const ì¡°ì›ëª©ë¡ = Object.values(weeklyData.ì¡°ì›ë³„ì§‘ê³„);
            const ì£¼ì°¨ìˆ˜ = ì¡°ì›ëª©ë¡[0]?.ì£¼ì°¨ë³„.length || 0;

            for (let i = 1; i <= ì£¼ì°¨ìˆ˜; i++) {
                html += `<th colspan="2" style="background-color: #2196F3; color: white;">${i}ì£¼ì°¨</th>`;
            }
            html += `<th rowspan="2" style="background-color: #f44336; color: white;">ì´ê²°ì„</th>`;
            html += `</tr><tr>`;

            // ì¸ì¦/ê²°ì„ ì„œë¸Œ í—¤ë”
            for (let i = 0; i < ì£¼ì°¨ìˆ˜; i++) {
                html += `
                    <th style="background-color: #64B5F6; color: white; font-size: 12px;">ì¸ì¦</th>
                    <th style="background-color: #64B5F6; color: white; font-size: 12px;">ê²°ì„</th>
                `;
            }
            html += `</tr></thead><tbody>`;

            // ì¡°ì›ë³„ ë°ì´í„°
            for (const [memberName, memberData] of Object.entries(weeklyData.ì¡°ì›ë³„ì§‘ê³„)) {
                html += `<tr>`;
                html += `<td style="font-weight: bold; text-align: left; padding-left: 15px;">${escapeHtml(memberName)}</td>`;

                // ì£¼ì°¨ë³„ ë°ì´í„°
                for (const week of memberData.ì£¼ì°¨ë³„) {
                    const ì¸ì¦ìƒ‰ = week.ì¸ì¦ >= week.í•„ìš” ? '#e8f5e9' : '#ffebee';
                    const ê²°ì„ìƒ‰ = week.ê²°ì„ > 0 ? '#ffcdd2' : '#f5f5f5';

                    // ì§„í–‰ì¤‘ì¸ ì£¼ëŠ” "-" í‘œì‹œ
                    const ì¸ì¦í‘œì‹œ = week.ì „ì²´ì¥ê¸°ì˜¤í”„ ? 'ğŸï¸' : `${week.ì¸ì¦}/${week.í•„ìš”}`;
                    const ê²°ì„í‘œì‹œ = week.ìƒíƒœ === 'ì§„í–‰ì¤‘' ? '-' : (week.ì „ì²´ì¥ê¸°ì˜¤í”„ ? '-' : week.ê²°ì„);

                    html += `<td style="background-color: ${ì¸ì¦ìƒ‰};">${ì¸ì¦í‘œì‹œ}</td>`;
                    html += `<td style="background-color: ${ê²°ì„ìƒ‰}; font-weight: ${week.ê²°ì„ > 0 ? 'bold' : 'normal'};">${ê²°ì„í‘œì‹œ}</td>`;
                }

                // ì´ê²°ì„
                const ì´ê²°ì„ìƒ‰ = memberData.ì´ê²°ì„ >= 4 ? '#f44336' : memberData.ì´ê²°ì„ === 3 ? '#ff9800' : '#4CAF50';
                const ì´ê²°ì„í…ìŠ¤íŠ¸ìƒ‰ = memberData.ì´ê²°ì„ >= 3 ? 'white' : 'black';
                html += `<td style="background-color: ${ì´ê²°ì„ìƒ‰}; color: ${ì´ê²°ì„í…ìŠ¤íŠ¸ìƒ‰}; font-weight: bold;">${memberData.ì´ê²°ì„}</td>`;

                html += `</tr>`;
            }

            html += `</tbody></table>`;

            // ë²”ë¡€ ì¶”ê°€
            html += `
                <div class="legend">
                    <h4 style="margin-top: 0;">ğŸ“– ë²”ë¡€</h4>
                    <div class="legend-items">
                        <div><span class="legend-box" style="background-color: #e8f5e9;"></span> ì¸ì¦ ì¶©ì¡±</div>
                        <div><span class="legend-box" style="background-color: #ffebee;"></span> ì¸ì¦ ë¶€ì¡±</div>
                        <div><span class="legend-box" style="background-color: #ffcdd2;"></span> ê²°ì„ ë°œìƒ</div>
                        <div><strong>-</strong> ì§„í–‰ì¤‘ (ê²°ì„ ë¯¸í™•ì •)</div>
                        <div><strong>ğŸï¸</strong> ì „ì²´ ì¥ê¸°ì˜¤í”„</div>
                    </div>
                </div>
            `;

            weeklyContainer.innerHTML = html;
        }

        /**
         * ë°ì´í„° ë¡œë“œ ë° ë Œë”ë§
         */
        async function loadData() {
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const contentDiv = document.getElementById('attendanceContent');

            try {
                loadingDiv.style.display = 'block';
                errorDiv.style.display = 'none';

                const yearMonth = `${year}-${String(month + 1).padStart(2, '0')}`;

                // JSON íŒŒì¼ URL êµ¬ì„±
                const baseUrl = 'https://drive.google.com/uc?export=download&id=';
                const attendanceUrl = `${baseUrl}${JSON_FILE_IDS.attendance}`;
                const weeklyUrl = `${baseUrl}${JSON_FILE_IDS.weekly}`;

                // ì¶œì„ ë°ì´í„° ë¡œë“œ
                console.log('ì¶œì„ ë°ì´í„° ë¡œë”©:', attendanceUrl);
                const attendanceResponse = await fetch(attendanceUrl);
                if (!attendanceResponse.ok) {
                    throw new Error(`ì¶œì„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${attendanceResponse.status}`);
                }
                const attendanceData = await attendanceResponse.json();
                console.log('ì¶œì„ ë°ì´í„° ë¡œë“œ ì„±ê³µ');

                // ì£¼ê°„ í†µê³„ ë¡œë“œ
                let weeklyData = null;
                try {
                    console.log('ì£¼ê°„ í†µê³„ ë¡œë”©:', weeklyUrl);
                    const weeklyResponse = await fetch(weeklyUrl);
                    if (weeklyResponse.ok) {
                        weeklyData = await weeklyResponse.json();
                        console.log('ì£¼ê°„ í†µê³„ ë¡œë“œ ì„±ê³µ:', weeklyData);
                    }
                } catch (e) {
                    console.log('ì£¼ê°„ í†µê³„ ë¡œë“œ ì‹¤íŒ¨ (ì„ íƒì‚¬í•­):', e);
                }

                // ì¶œì„í‘œ í‘œì‹œ (ì—¬ê¸°ì„œëŠ” ê°„ë‹¨íˆ ì²˜ë¦¬)
                contentDiv.innerHTML = `
                    <h2 style="text-align: center;">ì¼ê°„ ì¶œì„í‘œëŠ” ê¸°ì¡´ index.html ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì„¸ìš”</h2>
                    <p style="text-align: center; color: #666;">
                        ì´ íŒŒì¼ì€ ì£¼ê°„ í†µê³„ ê¸°ëŠ¥ë§Œ ë³´ì—¬ì£¼ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.<br>
                        ì‹¤ì œë¡œëŠ” floating535-lang/study-attendanceì˜ index.htmlì—<br>
                        ì£¼ê°„ í†µê³„ ë¶€ë¶„ë§Œ ì¶”ê°€í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
                    </p>
                `;
                contentDiv.style.display = 'block';

                // ì£¼ê°„ í†µê³„ ë Œë”ë§
                if (weeklyData) {
                    renderWeeklySummary(weeklyData);
                }

                // ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
                document.getElementById('lastUpdate').textContent =
                    `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${new Date().toLocaleString('ko-KR')}`;

                loadingDiv.style.display = 'none';

            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                errorDiv.innerHTML = `
                    <h3>âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>
                    <p>${error.message}</p>
                    <p style="font-size: 14px; color: #666;">
                        JSON íŒŒì¼ IDë¥¼ í™•ì¸í•˜ì„¸ìš”:<br>
                        attendance: ${JSON_FILE_IDS.attendance}<br>
                        weekly: ${JSON_FILE_IDS.weekly}
                    </p>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ë¡œë“œ
        window.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
